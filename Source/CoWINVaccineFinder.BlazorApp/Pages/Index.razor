@page "/"
@inject IStringLocalizer<Index> localizer
@inject IndexViewModel indexViewModel

<MudGrid Justify="Justify.Center">
    <MudItem xs="12" sm="8" md="9">
        <MudCard Elevation="25">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText>Login Details</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudGrid>
                    <MudItem xs="6" md="3">
                        <MudTextField T="string"
                                      FullWidth="false"
                                      Label=@localizer["Mobile Number"]
                                      @bind-Value ="@indexViewModel.MobileNumber"
                                      HelperText="Enter 10 digit mobile number"
                                      Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem Class="d-flex align-center"
                             xs="6" md="3">
                        <MudButton Variant="Variant.Filled"
                                   OnClick="@indexViewModel.GetOTP"
                                   Color="Color.Primary">GET OTP</MudButton>
                    </MudItem>
                    <MudItem xs="6" md="3">
                        <MudTextField T="string"
                                      Label="OTP"
                                      Disabled="@indexViewModel.OTPField"
                                      HelperText="Enter 6 digit otp"
                                      Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem Class="d-flex align-center"
                             xs="6" md="3">
                        <MudButton Variant="Variant.Filled"
                                   Disabled="@indexViewModel.OTPButton"
                                   OnClick="@indexViewModel.ValidateOTP"
                                   Color="Color.Primary">VALIDATE OTP</MudButton>
                    </MudItem>
                </MudGrid>
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12" sm="8" md="9">
        <EditForm Model="@indexViewModel" OnValidSubmit="@indexViewModel.StartSearchAsync">
            <MudCard Elevation="25">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText>Vaccine Search Criteria</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudAutocomplete T="string"
                                             Label="States"
                                             @bind-Value="@indexViewModel.StateSearchParameters"
                                             SearchFunc="@indexViewModel.SearchStates" />
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudAutocomplete T="string"
                                             Label="Districts"
                                             @bind-Value="@indexViewModel.DistrictSearchParameters"
                                             SearchFunc="@indexViewModel.SearchDistricts" />
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
                <MudCardActions Class="pb-4 pl-4">
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               Class="ml-auto"
                               ButtonType="ButtonType.Submit">Search</MudButton>
                </MudCardActions>
            </MudCard>
        </EditForm>
    </MudItem>
    <MudItem xs="12" sm="8" md="9">
        <MudCard Elevation="25">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText>Search Results</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTable Items="@indexViewModel.AvailableVaccineCenters" Hover="true" Breakpoint="Breakpoint.Sm">
                    <HeaderContent>
                        <MudTh>Center Name</MudTh>
                        <MudTh>Vaccine Type</MudTh>
                        <MudTh>Minimum Age Limit</MudTh>
                        <MudTh>Availability</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Center Name">@context.CenterName</MudTd>
                        <MudTd DataLabel="Vaccine Type">@context.VaccineType</MudTd>
                        <MudTd DataLabel="Minimum Age Limit">@context.MinimumAgeLimit.</MudTd>
                        <MudTd DataLabel="Availability">@context.Availability</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>

@code{

    protected override void OnInitialized()
    {
        indexViewModel.StateHasChangedDelegate = StateHasChanged;
    }
}
